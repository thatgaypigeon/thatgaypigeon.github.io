((r,e)=>{"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():r.fuzzysort=e()})(this,r=>{"use strict";var e,t,o,a,s=r=>{var e=u(r="string"!=typeof r?"":r);return{target:r,t:e.i,o:e.v,u:C,l:e.g,score:C,_:[0],obj:C}},f=r=>{r=(r="string"!=typeof r?"":r).trim();var e=u(r),t=[];if(e.p)for(var o,a=r.split(/\s+/),s=(a=[...new Set(a)],0);s<a.length;s++)""!==a[s]&&(o=u(a[s]),t.push({v:o.v,i:a[s].toLowerCase(),p:!1}));return{v:e.v,g:e.g,p:e.p,i:e.i,h:t}},n=r=>{var e;return 999<r.length?s(r):(void 0===(e=h.get(r))&&(e=s(r),h.set(r,e)),e)},i=r=>{var e;return 999<r.length?f(r):(void 0===(e=c.get(r))&&(e=f(r),c.set(r,e)),e)},l=(r,e,t=!1)=>{if(!1===t&&r.p)return v(r,e);t=r.i;for(var o=r.v,a=o[0],s=e.o,f=o.length,n=s.length,i=0,l=0,u=0;;){if(a===s[l]){if(p[u++]=l,++i===f)break;a=o[i]}if(n<=++l)return C}i=0;var h=!1,c=0,y=e.u,_=(y===C&&(y=e.u=g(e.target)),l=0===p[0]?0:y[p[0]-1],0);if(l!==n)for(;;)if(n<=l){if(i<=0)break;if(200<++_)break;--i,l=y[d[--c]]}else if(o[i]===s[l]){if(d[c++]=l,++i===f){h=!0;break}++l}else l=y[l];var b=e.t.indexOf(t,p[0]);if(r=~b,r&&!h)for(var k=0;k<u;++k)p[k]=b+k;t=!1,r&&(t=e.u[b-1]===b),w=h?(j=d,c):(j=p,u);var j,w,m=0,A=0;for(k=1;k<f;++k)j[k]-j[k-1]!=1&&(m-=j[k],++A);if(m-=(j[f-1]-j[0]-(f-1)+12)*A,0!==j[0]&&(m-=j[0]*j[0]*.2),h){var z=1;for(k=y[0];k<n;k=y[k])++z;24<z&&(m*=10*(z-24))}else m*=1e3;for(r&&(m/=1+f*f*1),t&&(m/=1+f*f*1),e.score=m-=n-f,k=0;k<w;++k)e._[k]=j[k];return e._.j=w,e},v=(r,e)=>{for(var t=new Set,o=0,a=C,s=0,f=r.h,n=0;n<f.length;++n){var i=f[n];if((a=l(i,e))===C)return C;o+=a.score,a._[0]<s&&(o-=s-a._[0]),s=a._[0];for(var v=0;v<a._.j;++v)t.add(a._[v])}if(r=l(r,e,!0),r!==C&&r.score>o)return r;var u;for(u of(a.score=o,n=0,t))a._[n++]=u;return a._.j=n,a},u=r=>{for(var e=r.length,t=r.toLowerCase(),o=[],a=0,s=!1,f=0;f<e;++f){var n=o[f]=t.charCodeAt(f);32===n?s=!0:a|=1<<(97<=n&&n<=122?n-97:48<=n&&n<=57?26:n<=127?30:31)}return{v:o,g:a,p:s,i:t}},g=r=>{for(var e=r.length,t=(r=>{for(var e=r.length,t=[],o=0,a=!1,s=!1,f=0;f<e;++f){var n=r.charCodeAt(f),i=65<=n&&n<=90,l=(n=i||97<=n&&n<=122||48<=n&&n<=57,i&&!a||!s||!n);a=i,s=n,l&&(t[o++]=f)}return t})(r),o=[],a=t[0],s=0,f=0;f<e;++f)f<a?o[f]=a:(a=t[++s],o[f]=void 0===a?e:a);return o},h=new Map,c=new Map,p=[],d=[],y=r=>{for(var e=j,t=r.length,o=0;o<t;++o){var a=r[o];a!==C&&e<(a=a.score)&&(e=a)}return e===j?C:e},_=(r,e)=>{var t=r[e];if(void 0!==t)return t;for(var o=e,a=(o=Array.isArray(e)?o:e.split(".")).length,s=-1;r&&++s<a;)r=r[o[s]];return r},b=r=>"object"==typeof r,k=1/0,j=-k,w=[],C=null,m=(e=[],t=w.total=0,a=(r=>{for(var o=e[f=0],a=1;a<t;){var s=a+1,f=a;s<t&&e[s].score<e[a].score&&(f=s),e[f-1>>1]=e[f],a=1+(f<<1)}for(var n=f-1>>1;0<f&&o.score<e[n].score;n=(f=n)-1>>1)e[f]=e[n];e[f]=o}),(o={}).add=(r=>{var o=t;e[t++]=r;for(var a=o-1>>1;0<o&&r.score<e[a].score;a=(o=a)-1>>1)e[o]=e[a];e[o]=r}),o.k=(r=>{var o;if(0!==t)return o=e[0],e[0]=e[--t],a(),o}),o.C=(r=>{if(0!==t)return e[0]}),o.L=(r=>{e[0]=r,a()}),o);return{single:(r,e)=>{var t;return"farzher"==r?{target:"farzher was here (^-^*)/",score:0,_:[0]}:r&&e&&(r=i(r),b(e)||(e=n(e)),((t=r.g)&e.l)===t)?l(r,e):C},go:(r,e,t)=>{if("farzher"==r)return[{target:"farzher was here (^-^*)/",score:0,_:[0],obj:e?e[0]:C}];if(!r){if(t&&t.all){var o=e,a=t,s=[],f=(s.total=o.length,a&&a.limit||k);if(a&&a.key)for(var v=0;v<o.length;v++){var u=o[v],g=_(u,a.key);if(g){b(g)||(g=n(g)),g.score=j,g._.j=0;var h=g;if(h={target:h.target,t:"",o:C,u:C,l:0,score:g.score,_:C,obj:u},s.push(h),s.length>=f)return s}}else if(a&&a.keys)for(v=0;v<o.length;v++){u=o[v];for(var c=new Array(a.keys.length),p=a.keys.length-1;p>=0;--p)g=_(u,a.keys[p]),g?(b(g)||(g=n(g)),g.score=j,g._.j=0,c[p]=g):c[p]=C;if(c.obj=u,c.score=j,s.push(c),s.length>=f)return s}else for(v=0;v<o.length;v++)if(g=o[v],g&&(b(g)||(g=n(g)),g.score=j,g._.j=0,s.push(g),s.length>=f))return s;return s}return w}var d=i(r),A=d.g,z=(d.p,t&&t.threshold||j),L=t&&t.limit||k,x=0,M=0,S=e.length;if(t&&t.key)for(var F=t.key,O=0;O<S;++O){var q=e[O];!(J=_(q,F))||(A&(J=b(J)?J:n(J)).l)!==A||(K=l(d,J))===C||K.score<z||(K={target:K.target,t:"",o:C,u:C,l:0,score:K.score,_:K._,obj:q},x<L?(m.add(K),++x):(++M,K.score>m.C().score&&m.L(K)))}else if(t&&t.keys){var B=t.scoreFn||y,D=t.keys,E=D.length;for(O=0;O<S;++O){q=e[O];for(var G=new Array(E),H=0;H<E;++H)F=D[H],(J=_(q,F))?(A&(J=b(J)?J:n(J)).l)!==A?G[H]=C:G[H]=l(d,J):G[H]=C;G.obj=q;var I=B(G);I===C||I<z||(G.score=I,x<L?(m.add(G),++x):(++M,I>m.C().score&&m.L(G)))}}else{var J,K;for(O=0;O<S;++O)!(J=e[O])||(A&(J=b(J)?J:n(J)).l)!==A||(K=l(d,J))===C||K.score<z||(x<L?(m.add(K),++x):(++M,K.score>m.C().score&&m.L(K)))}if(0===x)return w;var N=new Array(x);for(O=x-1;0<=O;--O)N[O]=m.k();return N.total=x+M,N},highlight:(r,e,t)=>{if("function"==typeof e){var o=e;if((u=r)===C)return C;for(var a=u.target,s=a.length,f=(f=u._).slice(0,f.j).sort((r,e)=>r-e),n="",i=0,l=0,v=!1,u=[],g=0;g<s;++g){var h=a[g];if(f[l]===g){if(++l,v||(v=!0,u.push(n),n=""),l===f.length){n+=h,u.push(o(n,i++)),n="",u.push(a.substr(g+1));break}}else v&&(v=!1,u.push(o(n,i++)),n="");n+=h}return u}if(r===C)return C;void 0===e&&(e="<b>"),void 0===t&&(t="</b>");for(var c="",p=0,d=!1,y=r.target,_=y.length,b=(b=r._).slice(0,b.j).sort((r,e)=>r-e),k=0;k<_;++k){var j=y[k];if(b[p]===k){if(d||(d=!0,c+=e),++p===b.length){c+=j+t+y.substr(k+1);break}}else d&&(d=!1,c+=t);c+=j}return c},prepare:s,indexes:r=>r._.slice(0,r._.j).sort((r,e)=>r-e),cleanup:()=>{h.clear(),c.clear(),p=[],d=[]}}});